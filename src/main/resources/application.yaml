server:
  port: 8582

management:
  endpoints:
    web:
      exposure:
        include: '*'
      base-path: /
  endpoint:
    health:
      show-details: always

# liveness alert settings depend on application name, if it is changed alert configuration must also be adjusted
# https://github.com/hmcts/bulk-scan-shared-infrastructure/blob/master/liveness-alert.tf
spring:
  application:
    name: Bulk Scan Orchestrator

azure:
  servicebus:
    envelopes:
      connection-string: ${ENVELOPES_QUEUE_CONNECTION_STRING}
      queue-name: envelopes
      max-delivery-count: ${ENVELOPES_QUEUE_MAX_DELIVERY_COUNT}
    processed-envelopes:
      connection-string: ${PROCESSED_ENVELOPES_QUEUE_CONNECTION_STRING}
      queue-name: processed-envelopes
    payments:
      connection-string: ${PAYMENTS_QUEUE_CONNECTION_STRING}
      queue-name: payments

core_case_data:
  api:
    url: 'http://localhost:4452'

document_management:
  url: ${DOCUMENT_MANAGEMENT_URL:http://localhost:4460}
  context-path: documents

idam:
  s2s-auth:
    url:    ${S2S_URL:http://localhost:4552}
    secret: ${S2S_SECRET:AAAAAAAAAAAAAAAA}
    name:   ${S2S_NAME:bulk_scan_orchestrator}
  api:
    url: http://localhost:8080
  client:
    id: 'bsp'
    secret: ${IDAM_CLIENT_SECRET:123456}
    redirect_uri: http://localhost/receiver
  users:
    bulkscan:
      username: ${IDAM_USERS_BULKSCAN_USERNAME:bulkscan+ccd@gmail.com}
      password: ${IDAM_USERS_BULKSCAN_PASSWORD:Password12}

service-config:
  # Services and all their case type IDs, excluding exception records.
  # These mappings are used by Bulk Scan to determine which case type IDs to search across
  # when looking for a service case (by its legacy ID, ID of related exception record, etc).
  # Those CTIDs that are not present here, will not be included in the search.
  # If case type ID list is empty, no case can be found for the service, except when sought for by CCD ID.
  services:
    - service: bulkscan # service name corresponds to the name of the container in Blob Storage
      jurisdiction: BULKSCAN
      transformation-url: ${TRANSFORMATION_URL_BULKSCAN}
      update-url: ${UPDATE_URL_BULKSCAN}
      case-type-ids:
        - Bulk_Scanned
      allow-creating-case-before-payments-are-processed: true
      allow-attaching-to-case-before-payments-are-processed-for-classifications:
        - SUPPLEMENTARY_EVIDENCE
      form-type-to-surname-ocr-field-mappings:
        - formType: PERSONAL
          ocrFields:
            - last_name

    - service: sscs
      jurisdiction: SSCS
      case-type-ids: []
      form-type-to-surname-ocr-field-mappings:
        - formType: sscs1
          ocrFields:
            - person2_last_name
            - person1_last_name
        - formType: SSCS1
          ocrFields:
            - person2_last_name
            - person1_last_name
        - formType: SSCS1PE
          ocrFields:
            - person2_last_name
            - person1_last_name

    - service: probate
      jurisdiction: PROBATE
      transformation-url: ${TRANSFORMATION_URL_PROBATE}
      case-type-ids:
        - GrantOfRepresentation
        - Caveat
        - StandingSearch
        - WillLodgement
      allow-creating-case-before-payments-are-processed: true

    - service: divorce
      jurisdiction: DIVORCE
      case-type-ids:
        - DIVORCE
        - DIVORCE_NOTICE_OF_ACTING
      transformation-url: ${TRANSFORMATION_URL_DIVORCE}
      allow-creating-case-before-payments-are-processed: true

    - service: finrem
      jurisdiction: DIVORCE
      case-type-ids:
        - FinancialRemedyMVP2
        - FinancialRemedyContested
      transformation-url: ${TRANSFORMATION_URL_FINREM}
      allow-creating-case-before-payments-are-processed: true

    - service: cmc
      jurisdiction: CMC
      case-type-ids:
        - MoneyClaimCase

    - service: publiclaw
      jurisdiction: PUBLICLAW
      case-type-ids: []

scheduling:
  task:
    delete-envelopes-dlq-messages:
      enabled: ${DELETE_ENVELOPES_DLQ_MESSAGES_ENABLED:false}
      cron: ${DELETE_ENVELOPES_DLQ_MESSAGES_CRON}
      ttl: ${DELETE_ENVELOPES_DLQ_MESSAGES_TTL}

hystrix:
  command:
    default:
      execution.timeout.enabled: false
      fallback.enabled: true
      circuitBreaker.enabled: true
    check-jurisdiction-log-in:
      circuitBreaker:
        requestVolumeThreshold: 1
        sleepWindowInMilliseconds: 300000 # pause processing for 5 minutes if IDAM rejects log-in attempts
        errorThresholdPercentage: 1

task:
  check-jurisdiction-log-in:
    check-validity-duration: PT5M # only ensure this often that no log-in attempt is rejected by IDAM

